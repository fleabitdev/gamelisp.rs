<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Miscellaneous - GameLisp Reference Manual</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">Overview</a></li><li class="chapter-item expanded affix "><a href="introduction-for-rust-programmers.html">Introduction for Rust Programmers</a></li><li class="chapter-item expanded affix "><a href="introduction-for-lisp-programmers.html">Introduction for Lisp Programmers</a></li><li class="chapter-item expanded "><a href="the-language.html"><strong aria-hidden="true">1.</strong> The Language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="syntax-and-types.html"><strong aria-hidden="true">1.1.</strong> Syntax and Types</a></li><li class="chapter-item expanded "><a href="evaluation.html"><strong aria-hidden="true">1.2.</strong> Evaluation</a></li><li class="chapter-item expanded "><a href="macros.html"><strong aria-hidden="true">1.3.</strong> Macros</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="built-in-macros.html"><strong aria-hidden="true">1.3.1.</strong> Built-in Macros</a></li></ol></li><li class="chapter-item expanded "><a href="numbers.html"><strong aria-hidden="true">1.4.</strong> Numbers</a></li><li class="chapter-item expanded "><a href="arrays.html"><strong aria-hidden="true">1.5.</strong> Arrays</a></li><li class="chapter-item expanded "><a href="strings-and-text.html"><strong aria-hidden="true">1.6.</strong> Strings and Text</a></li><li class="chapter-item expanded "><a href="tables.html"><strong aria-hidden="true">1.7.</strong> Tables</a></li><li class="chapter-item expanded "><a href="iterators.html"><strong aria-hidden="true">1.8.</strong> Iterators</a></li><li class="chapter-item expanded "><a href="coroutines.html"><strong aria-hidden="true">1.9.</strong> Coroutines</a></li><li class="chapter-item expanded "><a href="patterns.html"><strong aria-hidden="true">1.10.</strong> Patterns</a></li><li class="chapter-item expanded "><a href="object-oriented-programming.html"><strong aria-hidden="true">1.11.</strong> Object-Oriented Programming</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="state-machines.html"><strong aria-hidden="true">1.11.1.</strong> State Machines</a></li><li class="chapter-item expanded "><a href="code-reuse.html"><strong aria-hidden="true">1.11.2.</strong> Code Reuse</a></li><li class="chapter-item expanded "><a href="structs.html"><strong aria-hidden="true">1.11.3.</strong> Structs</a></li></ol></li><li class="chapter-item expanded "><a href="errors.html"><strong aria-hidden="true">1.12.</strong> Errors</a></li><li class="chapter-item expanded "><a href="miscellaneous.html" class="active"><strong aria-hidden="true">1.13.</strong> Miscellaneous</a></li></ol></li><li class="chapter-item expanded "><a href="the-rust-api.html"><strong aria-hidden="true">2.</strong> The Rust API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="the-glsp-crate.html"><strong aria-hidden="true">2.1.</strong> The glsp Crate</a></li><li class="chapter-item expanded "><a href="collection-types.html"><strong aria-hidden="true">2.2.</strong> Collection Types</a></li><li class="chapter-item expanded "><a href="rust-bindings.html"><strong aria-hidden="true">2.3.</strong> Rust Bindings</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rfn.html"><strong aria-hidden="true">2.3.1.</strong> RFn</a></li><li class="chapter-item expanded "><a href="rdata.html"><strong aria-hidden="true">2.3.2.</strong> RData</a></li><li class="chapter-item expanded "><a href="rclass.html"><strong aria-hidden="true">2.3.3.</strong> RClass</a></li><li class="chapter-item expanded "><a href="rglobal.html"><strong aria-hidden="true">2.3.4.</strong> RGlobal</a></li></ol></li><li class="chapter-item expanded "><a href="garbage-collection.html"><strong aria-hidden="true">2.4.</strong> Garbage Collection</a></li><li class="chapter-item expanded "><a href="procedural-macros.html"><strong aria-hidden="true">2.5.</strong> Procedural Macros</a></li><li class="chapter-item expanded "><a href="compilation.html"><strong aria-hidden="true">2.6.</strong> Compilation</a></li><li class="chapter-item expanded "><a href="feature-flags.html"><strong aria-hidden="true">2.7.</strong> Feature Flags</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="performance-figures.html">Appendix A: Performance Figures</a></li><li class="chapter-item expanded affix "><a href="naming-conventions.html">Appendix B: Naming Conventions</a></li><li class="chapter-item expanded affix "><a href="implementation-limits.html">Appendix C: Implementation Limits</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                    </div>

                    <h1 class="menu-title">GameLisp Reference Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#miscellaneous" id="miscellaneous">Miscellaneous</a></h1>
<h2><a class="header" href="#freezing-data" id="freezing-data">Freezing Data</a></h2>
<p>GameLisp's variables and collections are mutable by default. This is convenient, but it can also
be nerve-wracking. It's sometimes difficult to know whether or not you have exclusive ownership of
a collection, so there's always the risk that typing <code>(push! ar x)</code> or <code>(clear! coll)</code> could 
have unintended side-effects in some distant part of your codebase.</p>
<p>The <a href="../std/freeze-mut"><code>freeze!</code> function</a> takes any number of GameLisp values as arguments. 
For each value which refers to an array, string, table, or object, a flag is set on that 
collection which prevents it from being mutated. Future calls to <code>(= [ob 'x] 10)</code>, 
<code>(swap-remove! ar 5)</code> and so on will trigger an error. Frozen collections can never be unfrozen, 
and they can't even be mutated using the Rust API.</p>
<p><code>freeze!</code> is not recursive: you can always mutate a non-frozen collection, even if you're 
accessing it via a frozen collection. To freeze a value <em>and</em> all of the values which it
transitively refers to, use <a href="../std/deep-freeze-mut"><code>deep-freeze!</code></a> instead.</p>
<p>Finally, you'll sometimes want the security of knowing that a global variable can't be 
accidentally mutated. You can enforce this by calling <a href="../std/freeze-global-mut"><code>freeze-global!</code></a>.
(GameLisp automatically freezes a few of the built-in functions, such as <code>+</code>, so that they can be 
optimized more aggressively.)</p>
<pre><code>(def ar (arr (arr 'a 0) (arr 'b 1)))

(push! ar (arr 'c 2))
(prn ar) ; prints ((a 0) (b 1) (c 2))

(freeze-global! 'ar)
;(= ar '()) ; this would be an error

(freeze! ar)
;(push! ar (arr 'd 3)) ; this would be an error
(push! [ar 0] 0)
(prn ar) ; prints ((a 0 0) (b 1) (c 2))

(deep-freeze! ar)
;(push! [ar 1] 1) ; this would be an error
</code></pre>
<h3><a class="header" href="#literals" id="literals">Literals</a></h3>
<p>Using <code>quote</code> or self-evaluating types, it's possible to create multiple aliasing references to 
data which was originally passed in to the <a href="evaluation.html">evaluator</a>. For example:</p>
<pre><code>(loop
  (let ar ())
  (push! ar 1)
  (prn ar))
</code></pre>
<p>Intuitively, you might expect <code>ar</code> to be a fresh, empty array each time it's initialized, so that
the <code>prn</code> call prints <code>(1)</code> every time. Unfortunately, because empty arrays are self-evaluating,
the <code>()</code> form will repeatedly return the same array. This loop would print <code>(1)</code>, then <code>(1 1)</code>, 
then <code>(1 1 1)</code>...</p>
<p>In order to prevent this, whenever GameLisp encounters a <code>quoted</code> or self-evaluating array, string
or table, if it's not already deep-frozen then it will be replaced with a 
<a href="#cloning-data">deep-cloned</a>, <a href="#freezing-data">deep-frozen</a> copy of itself. This means that 
self-evaluating forms and <code>quoted</code> forms are always immutable, avoiding problems like the above.</p>
<p>To make unintended mutation even less likely, all data produced by the parser is automatically 
frozen. You can <a href="#cloning-data">clone</a> the data if you need a mutable copy.</p>
<h2><a class="header" href="#cloning-data" id="cloning-data">Cloning Data</a></h2>
<p>The <a href="../std/clone"><code>clone</code> function</a> receives a single value as its argument. If this value is 
an array, string, table, or iterator, it returns a shallow copy of that value. The copy will be 
mutable, even if the original collection was frozen.</p>
<p>The <a href="../std/deep-clone"><code>deep-clone</code> function</a> shallow-clones its argument, and then recurses 
through to clone any collections referred to by the argument, and any collections referred to 
by <em>those</em> collections, and so on.</p>
<p>Cloning an iterator will never clone the array, string or table which is being iterated, even when 
using <code>deep-clone</code>. When they encounter an iterator, both <code>clone</code> and <code>deep-clone</code> perform just 
enough copying to ensure that <a href="../std/iter-next-mut"><code>iter-next!</code></a> will not modify the original 
iterator.</p>
<h2><a class="header" href="#equality" id="equality">Equality</a></h2>
<p>GameLisp provides four different equality tests. This is a necessary complication: in 
languages like Rust, the <code>==</code> operator is heavily overloaded, which it its own <a href="https://doc.rust-lang.org/std/cmp/trait.PartialEq.html">source</a> 
of <a href="https://doc.rust-lang.org/std/rc/struct.Rc.html#method.ptr_eq">complexity</a>.</p>
<p>In GameLisp, the <a href="../std/num-eq"><code>==</code> function</a> specifically tests for numeric equality. It 
exists to complement the other numeric comparison functions: <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code> and <code>&gt;</code>. It's an 
error to pass a non-numeric value to <code>==</code>.</p>
<p>The <a href="../std/same-p"><code>same?</code> function</a> tests for <a href="https://en.wikipedia.org/wiki/Identity_(object-oriented_programming)">identity</a>. For all <a href="syntax-and-types.html#type-summary">reference 
types</a>, two references are the <code>same?</code> if they point to the 
same allocation.</p>
<p><code>same?</code> is usually more strict than you'd like. For example, <code>(same? '(1 2) (arr 1 2))</code> will 
return <code>#f</code>, because it sees its arguments as being two distinct arrays, even though they have 
identical contents.</p>
<p>You'll generally want to use the <a href="../std/eq-p"><code>eq?</code> function</a> instead. It differs from <code>same?</code> 
in that arrays, strings and tables are deeply inspected: they compare equal when their contents
are recursively identical.</p>
<p>The final built-in equality test is <code>keys-eqv?</code>, which was 
<a href="tables.html#key-equivalence">discussed previously</a>.</p>
<h3><a class="header" href="#multiple-comparisons" id="multiple-comparisons">Multiple Comparisons</a></h3>
<p>Functions like <code>==</code> and <code>eq?</code> are variadic. <code>(== a b c d)</code> tests whether <code>a</code>, <code>b</code>, <code>c</code> and <code>d</code> 
are all <code>==</code> to one another.</p>
<p>If you need to test one value against multiple others, you can use the functions 
<a href="../std/num-eq-any-p"><code>==any?</code></a>, <a href="../std/same-any-p"><code>same-any?</code></a> and 
<a href="../std/eq-any-p"><code>eq-any?</code></a>.</p>
<pre><code>(ensure (eq-any? (coro-state c) 'newborn 'running 'paused 'finished 'poisoned))

(when (same-any? current-room graveyard dungeon prison-cell)
  (inc! fear-level))
</code></pre>
<h2><a class="header" href="#time-and-date" id="time-and-date">Time and Date</a></h2>
<p>Because the Rust standard library only has limited facilities for handling time, the same is
true for GameLisp.</p>
<p>The <a href="../std/time"><code>time</code> function</a> returns a high-precision <a href="https://doc.rust-lang.org/std/time/struct.Instant.html">monotonic timestamp</a> measured in 
seconds, and the <a href="../std/sleep"><code>sleep</code> function</a> suspends the current thread for a specified 
number of seconds. Note that although <code>time</code> should have excellent precision on all platforms, 
<code>sleep</code> is often very imprecise, particularly on Windows. You should prefer to time your main 
loop using an external signal, such as blocking on VSync.</p>
<p>The only date-and-time facility provided by GameLisp is the <a href="../std/unix-time"><code>unix-time</code> 
function</a>, which returns the number of elapsed whole seconds in the 
<a href="https://en.wikipedia.org/wiki/Unix_time">UNIX epoch</a>. In order to avoid the <a href="https://en.wikipedia.org/wiki/Year_2038_problem">2038 problem</a> it returns a string, such as <code>&quot;1153689688&quot;</code>. 
It's intended to be used as a basic timestamp for logging - it can't be readily converted into a 
human-readable format.</p>
<h2><a class="header" href="#last-but-not-least" id="last-but-not-least">Last But <code>(not least)</code>...</a></h2>
<p>The <a href="../std/not"><code>not</code> function</a> returns <code>#t</code> for a <a href="syntax-and-types.html#bool">falsy</a> argument, 
and <code>#f</code> for a <a href="syntax-and-types.html#bool">truthy</a> argument.</p>
<p>The <a href="../std/identity"><code>identity</code> function</a> accepts a single argument and returns it unchanged.
The <a href="../std/no-op"><code>no-op</code> function</a> accepts any number of arguments and returns <code>#n</code>. Both are
occasionally useful as first-class functions.</p>
<p>The <a href="../std/fn0"><code>fn0</code></a> and <a href="../std/fn1"><code>fn1</code></a> macros provide a concise way to define functions
with zero or one arguments. <code>fn1</code> can use a single underscore, <code>_</code>, to refer to its argument. 
Within a <code>fn1</code> form, you should try to avoid discarding a value in a pattern (e.g. 
<code>(match ... (_ x))</code>), since it can be visually confusing.</p>
<pre><code>(ensure (all? (fn1 (eq? _ 'red)) colors) &quot;non-red color detected&quot;)

; ...is equivalent to...

(ensure (all? (fn (color) (eq? color 'red)) colors) &quot;non-red color detected&quot;)
</code></pre>
<p>In Section 2, we'll discuss how to invoke and tune the <a href="garbage-collection.html">garbage collector</a> 
from Rust. You might find that you prefer to do that from within GameLisp, in which case you
can use the functions <a href="../std/gc"><code>gc</code></a> and <a href="../std/gc-value"><code>gc-value</code></a>.</p>
<h2><a class="header" href="#inputoutput" id="inputoutput">Input/Output</a></h2>
<p>You may have noted the conspicuous absence of an input/output (IO) library. GameLisp doesn't
provide any built-in functions for filesystem access, beyond <code>load</code>, <code>require</code> and <code>include</code>.</p>
<p>This is a deliberate design choice. IO is a huge topic: a full-featured IO library
for game development would need to include byte streams, compression, string streams, stdio,
text encodings, networking, non-blocking io, sandboxing, logging... the list goes on.</p>
<p>Meanwhile, your game engine will almost certainly have its own opinions about how filesystem and 
network access should be done. Something as simple as storing your game's assets in a .zip
file might make the entire IO library unusable!</p>
<p>Instead, you're encouraged to use the <a href="the-rust-api.html">Rust API</a> to bind your engine's existing 
APIs to GameLisp.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="errors.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="the-rust-api.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="errors.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="the-rust-api.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="glsp-highlight.js"></script>
        

        

    </body>
</html>
